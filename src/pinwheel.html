<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <style>
      #wrapper {
        box-sizing: border-box;
        width: 288.44px;
        height: 288.44px;
        padding: 24.22px 0 0 144.22px;
      }
      /* @keyframes rotate {
            from{transform: rotate(0deg);}
            to{transform: rotate(120deg);}
        } */
      .f {
        /* display: none; */
        z-index: 1;
        clip-path: polygon(-10px -10px, -10px 130px, 71px -10px);
        /* opacity: 0.1; */
      }
      .m {
        /* opacity: 0.6; */
        /* z-index: 0; */
      }
      .b {
        /* display: none; */
        /* opacity: 0.1; */
        z-index: -1;
        /* clip-path: polygon(90px 130px, -10px 130px, 70px -10px, 90px -10px); */
        /* box-shadow: 2px 2px 10px 1px rgba(0, 0, 0, 0.3); */
      }
      .card {
        box-sizing: border-box;
        border-radius: 10px;
        color: white;
        font-weight: bold;
        padding: 10px;
        position: absolute;
        transform-origin: bottom left;
        border: none;
        word-break: break-all;
      }
    </style>
    <div id="wrapper"></div>
    <script>
      //4까지 괜찮
      const fullrad = Math.PI * 2;
      const fulldeg = 360;
      const quaterrad = Math.PI / 2;
      console.log(quaterrad);
      let onedeg;
      let onerad;
      //const colors = ['#000', '#000', '#000', '#000', '#000', '#000', '#000', '#000', '#000', '#000', '#000', '#000', '#000', '#000', '#000', '#000', '#000', '#000', '#000', '#000', '#000', '#000', '#000', '#000', '#000', '#000', '#000', '#000', '#000', '#000', '#000', '#000', '#000', '#000', '#000', '#000', '#000', '#000', '#000', '#000', '#000', '#000', '#000', '#000', '#000', '#000', '#000', '#000', '#000', '#000', '#000', '#000', '#000', '#000'];
      const colors = [
        "#a83332",
        "#ce5c32",
        "#c88235",
        "#dcd14a",
        "#d1d74c",
        "#90bb50",
        "#3f8e4c",
        "#4ba59c",
        "#54a8dd",
        "#2d6ab0",
        "#16105b",
        "#5f308c",
        "#a83332",
        "#ce5c32",
        "#c88235",
        "#dcd14a",
        "#d1d74c",
        "#90bb50",
        "#3f8e4c",
        "#4ba59c",
        "#54a8dd",
        "#2d6ab0",
        "#16105b",
        "#5f308c",
        "#a83332",
        "#ce5c32",
        "#c88235",
        "#dcd14a",
        "#d1d74c",
        "#90bb50",
        "#3f8e4c",
        "#4ba59c",
        "#54a8dd",
        "#2d6ab0",
        "#16105b",
        "#5f308c",
        "#a83332",
        "#ce5c32",
        "#c88235",
        "#dcd14a",
        "#d1d74c",
        "#90bb50",
        "#3f8e4c",
        "#4ba59c",
        "#54a8dd",
        "#2d6ab0",
        "#16105b",
        "#5f308c",
        "#a83332",
        "#ce5c32",
        "#c88235",
        "#dcd14a",
        "#d1d74c",
        "#90bb50",
        "#3f8e4c",
        "#4ba59c",
        "#54a8dd",
        "#2d6ab0",
        "#16105b",
        "#5f308c",
      ];

      window.onload = loadCard(12, colors, 80, 120);

      function calCoordi(width, height, number, i = 1) {
        const onerad = fullrad / number;

        const inRad = onerad * i;
        const outRad = quaterrad - inRad;

        const leftbottomW = 0;
        const leftbottomH = 0;

        const lefttopW = -Math.sin(inRad) * height;
        const lefttopH = Math.cos(inRad) * height;

        const rightbottomW = Math.cos(inRad) * width;
        const rightbottomH = Math.sin(inRad) * width;

        const righttopH = lefttopH + rightbottomH;
        const righttopW = lefttopW + rightbottomW;

        const clipCord = {
          leftTop: [lefttopW, lefttopH],
          rightTop: [righttopW, righttopH],
          leftBottom: [leftbottomW, leftbottomH],
          rightBottom: [rightbottomW, rightbottomH],
        };
        return clipCord;
      }

      function loadCard(number, colors, width, height) {
        onerad = fullrad / number;
        let mid = "";

        i = 1;
        while (i <= number) {
          let cal = Math.tan(onerad) * height;
          let rad = onerad * (i - 1);
          const coordi = calCoordi(width, height, number, i);
          let temp_html = `
            <div class="f card c${i}" onmouseover="movecard(${i})" style="background-color: ${
            colors[i - 1]
          }; transform:rotate(${
            onerad * (i - 1)
          }rad); width:${width}px; height:${height}px; clip-path: polygon(0px 0px, 0px ${height}px, ${cal}px 0px);" onmouseover="movecard(${i})">text${i}</div>
            <div class="b card c${i}" onmouseover="movecard(${i})" style="background-color: ${
            colors[i - 1]
          }; transform:rotate(${
            onerad * (i - 1)
          }rad); width:${width}px; height:${height}px;">text${i}</div>`;
          let exist = document.getElementById("wrapper").innerHTML;
          if (0 <= rad && rad < quaterrad) {
            j = i;
            let mid_html = ``;
            while (j > 0) {
              console.log(rad, ",", j);
              const coordi = calCoordi(width, height, number, j);
              console.log(coordi);
              let leftTopW = coordi.leftTop[0];
              let leftTopH = height - coordi.leftTop[1];
              let rightTopW = coordi.rightTop[0];
              let rightTopH = height - coordi.rightTop[1];
              let rightBottomW = coordi.rightBottom[0];
              let rightBottomH = height - coordi.rightBottom[1];
              let leftBottomW = 0;
              let leftBottomH = height;
              if (j > 1) {
                const coordi2 = calCoordi(width, height, number, j - 1);
                let leftTopW = coordi.leftTop[0];
                let leftTopH = height - coordi.leftTop[1];
                let rightTopW = coordi.rightTop[0];
                let rightTopH = height - coordi.rightTop[1];
                let rightBottomW = coordi.rightBottom[0];
                let rightBottomH = height - coordi.rightBottom[1];
                let leftBottomW = 0;
                let leftbottomH = height;
              }
              mid_html =
                `
                <div class="m card c${j}" style="z-index:0; background-color: ${
                  colors[j - 1]
                }; transform:rotate(${
                  onerad * (j - 1)
                }rad); width:${width}px; height:${height}px;
                clip-path: polygon(${leftTopW}px ${leftTopH}px,
                    ${rightTopW}px ${rightTopH}px,
                    ${rightBottomW}px ${rightBottomH}px,
                    ${leftBottomW}px ${leftBottomH}px);"
                    onmouseover="movecard(${j})">text${j}</div>
                            ` + mid_html;
              j--;
            }
            document.getElementById("wrapper").innerHTML =
              exist + mid_html + temp_html;
          } else {
            document.getElementById("wrapper").innerHTML = exist + temp_html;
          }
          ++i;
        }
        document.getElementById("wrapper").innerHTML =
          document.getElementById("wrapper").innerHTML + mid;
      }

      function movecard(index) {
        //('한각:',onerad);
        //console.log("계산:"+Math.tan(onerad)*120);
        const rad = onerad * (index - 1);
        const deg = onedeg * (index - 1);

        const cardHeight = 120;
        const cardWidth = 80;
        const aniDistance = cardHeight / 6;
        const card = document.querySelectorAll(`.c${index}`);

        let moveheight = -Math.cos(rad) * aniDistance;
        let movewidth = Math.sin(rad) * aniDistance;

        //console.log("cin:",Math.sin(rad), "cos:",Math.cos(rad));
        card.forEach((card) => {
          card.animate(
            [
              { transform: `translate(0px, 0px) rotate(${rad}rad)` },
              {
                transform: `translate(${movewidth}px, ${moveheight}px) rotate(${rad}rad)`,
              },
            ],
            {
              duration: 500,
              iterations: 1,
              timingFunction: "ease-in-out",
            }
          );
          //setTimeout(() => {console.log('setTimeout이 실행된 지 2초가 지났습니다.');}, 2000);
        });
      }
    </script>
  </body>
</html>
